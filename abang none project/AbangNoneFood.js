const katalog = {
  makanan: [
  { nama: "Pindang Bandeng", harga: 35000, gambar: "Makanan/bandeng.jpg", deskripsi: "Ikan gabus dengan kuah pindang coklat legam yang khas." },
  { nama: "Nasi Uduk Betawi", harga: 20000, gambar: "Makanan/uduk.jpg", deskripsi: "Nasi gurih dengan lauk pauk mantap untuk sarapan." },
  { nama: "Ayam Serundeng", harga: 15000, gambar: "Makanan/ayam.jpg", deskripsi: "Ayama goreng dan serundeng gurih." },
  { nama: "Orek Tempe", harga: 10000, gambar: "Makanan/orek.jpg", deskripsi: "Tempe iris tipis dimasak dengan bumbu manis pedas dan taburan cabai" },
  { nama: "Soto Betawi", harga: 25000, gambar: "Makanan/soto.jpg", deskripsi: "Kuah santan atau susu dengan daging sapi dan emping." },
  { nama: "Semur Jengkol", harga: 20000, gambar: "Makanan/jengkol.jpg", deskripsi: "Jengkol legit dimasak dengan bumbu semur manis." },
  { nama: "Sayur Asem", harga: 30000, gambar: "Makanan/sayur.jpg", deskripsi: "Versi sayur asem khas Betawi, segar dan sedikit manis." },
  { nama: "Ketoprak Betawi", harga: 20000, gambar: "Makanan/ketopra.jpg", deskripsi: "Lontong, tahu, bihun, dan bumbu kacang Betawi." },
  { nama: "Sop Iga Sapi", harga: 30000, gambar: "Makanan/iga.jpg", deskripsi: "Sop iga sapi dengan kuah bening gurih, dilengkapi wortel, kentang, dan taburan bawang goreng." },
  { nama: "Empal Goreng", harga: 25000, gambar: "Makanan/empal.jpg", deskripsi: "Daging sapi empuk digoreng dengan bumbu manis gurih khas Betawi" },
  { nama: "Laksa Betawi", harga: 25000, gambar: "Makanan/laksa.jpg", deskripsi: "Mie dan ketupat disajikan dengan kuah santan kental berbumbu kemiri khas Betawi." },
  { nama: "Lontong Sayur Betawi", harga: 27000, gambar: "Makanan/lonsay.jpg", deskripsi: "Lontong dengan kuah santan dan sayuran khas." },
  { nama: "Asinan Betawi", harga: 20000, gambar: "Makanan/asinan.jpg", deskripsi: "Sayur segar disiram kuah kacang asam manis." },
  { nama: "Gado-Gado Betawi", harga: 25000, gambar: "Makanan/gado.jpg", deskripsi: "Sayuran rebus dengan bumbu kacang kental." }
],
  camilan: [
    { nama: "Kerak Telor", harga: 20000, gambar: "Camilan/Kerak Telor.jpg", deskripsi: "Telur bebek, ketan, dan serundeng gurih." },
    { nama: "Kembang Goyang", harga: 15000, gambar: "Camilan/Kembang Goyang.jpg", deskripsi: "Kue renyah yang digoreng menggunakan cetakan." },
    { nama: "Kue Ape", harga: 10000, gambar: "Camilan/Kue Ape.jpg", deskripsi: "Tengahnya empuk, pinggirnya garing renyah." },
    { nama: "Kue Cucur", harga: 15000, gambar: "Camilan/Kue Cucur.jpg", deskripsi: "Kue goreng manis dari gula merah dan tepung beras." },
    { nama: "Kue Cincin", harga: 25000, gambar: "Camilan/cincin.jpg", deskripsi: "Seperti donat tapi rasa gula merah, khas dari Betawi pinggiran." },
    { nama: "Kue Lapis", harga: 25000, gambar: "Camilan/lapis.jpg", deskripsi: "Lapis kenyal warna-warni dari tepung sagu dan santan." },
    { nama: "Kue Lumpur", harga: 25000, gambar: "Camilan/lumpur.jpg", deskripsi: "Terbuat dari kentang, santan, dan telur ‚Äì teksturnya lembut dan manis." },
    { nama: "Kue Rangi", harga: 25000, gambar: "Camilan/rangi.jpg", deskripsi: "Kelapa parut dipanggang, disiram saus gula merah." },
    { nama: "Kue Talam", harga: 25000, gambar: "Camilan/talam.jpg", deskripsi: "Dua lapis ‚Äì lapisan atas santan, bawah gula merah atau ubi." },
    { nama: "Roti Buaya", harga: 25000, gambar: "Camilan/Roti Buaya.jpg", deskripsi: "Roti manis berbentuk buaya, untuk acara adat." },
    { nama: "Tape Uli", harga: 10000, gambar: "Camilan/Tape Uli.jpg", deskripsi: "Tape singkong dimakan bersama uli (ketan tumbuk)." }
  ],
  minuman: [
    { nama: "Air Batavia", harga: 15000, gambar: "Minuman/air.png", deskripsi: "Air mineral segar berasal dari bumi batavia." },
    { nama: "Bir Pletok", harga: 13000, gambar: "Minuman/pletok.jpg", deskripsi: "Minuman Jahe segar." },
    { nama: "Es Jeruk", harga: 13000, gambar: "Minuman/jeruk.jpeg", deskripsi: "Minuman segar dari perasan jeruk asli, disajikan dengan es batu. Rasanya manis-asam alami, cocok untuk pelepas dahaga." },
    { nama: "Es Cendol", harga: 13000, gambar: "Minuman/cendol.jpeg", deskripsi: "Cendol kenyal dari tepung hunkwe dengan siraman santan dan gula aren kental. Manis, lembut, dan sangat menyegarkan." },
    { nama: "Es Kelapa", harga: 13000, gambar: "Minuman/kelapa.jpeg", deskripsi: "Kelapa muda segar dengan sirup gula aren dan es batu. Perpaduan alami yang menyegarkan dan menyehatkan." },
    { nama: "Es Teh", harga: 13000, gambar: "Minuman/teh.jpeg", deskripsi: "Teh wangi khas warung Betawi, bisa disajikan hangat atau dingin. Simpel tapi bikin nagih." },
    { nama: "Es Selendang Mayang", harga: 13000, gambar: "Minuman/selendang.jpg", deskripsi: "Kue kenyal warna-warni dengan kuah santan manis." },
    { nama: "Es Doger", harga: 12000, gambar: "Minuman/doger.jpg", deskripsi: "Es campur dengan tape, ketan hitam, dan kelapa." }
  ]
};

let keranjang = [];

function generateProductHTML(item) {
  return `
    <div class="produk-gambar-container">
      <img src="${item.gambar}" alt="${item.nama}">
    </div>
    <div class="produk-info">
      <h3>${item.nama}</h3>
      <p class="produk-deskripsi">${item.deskripsi}</p>
      <div class="produk-footer">
        <p class="produk-harga">Rp ${item.harga.toLocaleString()}</p>
        <button onclick='tambahKeKeranjang(${JSON.stringify(item)})'>Beli</button>
      </div>
    </div>
  `;
}

function showCategory(kategori) {
  const container = document.getElementById('katalog');
  container.innerHTML = '';
  katalog[kategori].forEach(item => {
    const div = document.createElement('div');
    div.className = 'produk';
    div.innerHTML = generateProductHTML(item);
    container.appendChild(div);
  });
  document.getElementById('status-pesanan').style.display = 'none';
  document.getElementById('katalog').style.display = 'grid';
  if (keranjang.length > 0) {
      document.getElementById('keranjang').style.display = 'block';
  }
}

function cariProduk() {
  const kataKunci = document.getElementById('search-input').value.toLowerCase();
  const container = document.getElementById('katalog');
  container.innerHTML = '';

  Object.values(katalog).flat().forEach(item => {
    if (item.nama.toLowerCase().includes(kataKunci)) {
      const div = document.createElement('div');
      div.className = 'produk';
      div.innerHTML = generateProductHTML(item);
      container.appendChild(div);
    }
  });
  document.getElementById('status-pesanan').style.display = 'none';
  document.getElementById('katalog').style.display = 'grid';
  if (keranjang.length > 0) {
      document.getElementById('keranjang').style.display = 'block';
  }
}

function tambahKeKeranjang(item) {
  keranjang.push(item);
  updateKeranjang();
  document.getElementById('keranjang').style.display = 'block';
  document.getElementById('status-pesanan').style.display = 'none';
  document.getElementById('katalog').style.display = 'grid';
}

function updateKeranjang() {
  const daftar = document.getElementById('daftar-keranjang');
  const total = document.getElementById('total-harga');
  daftar.innerHTML = '';
  let totalHarga = 0;
  keranjang.forEach((item, index) => {
    const li = document.createElement('li');
    li.innerHTML = `
      <span>${item.nama} - Rp ${item.harga.toLocaleString()}</span>
      <button class="hapus-btn" onclick="hapusDariKeranjang(${index})">Hapus</button>
    `;
    daftar.appendChild(li);
    totalHarga += item.harga;
  });
  total.textContent = `Rp ${totalHarga.toLocaleString()}`;

  if(keranjang.length === 0) {
    document.getElementById('keranjang').style.display = 'none';
  }
}

function hapusDariKeranjang(index) {
  keranjang.splice(index, 1);
  updateKeranjang();
}

function checkout() {
  if (keranjang.length === 0) {
    alert('Keranjang masih kosong!');
    return;
  }

  const wilayah = localStorage.getItem('wilayahJakarta');
  let ongkir = 0;

  switch(wilayah) {
    case 'Jakarta Pusat': ongkir = 5000; break;
    case 'Jakarta Utara': ongkir = 10000; break;
    case 'Jakarta Selatan': ongkir = 15000; break;
    case 'Jakarta Barat': ongkir = 20000; break;
    case 'Jakarta Timur': ongkir = 25000; break;
    default: ongkir = 10000;
  }

  let subtotal = keranjang.reduce((total, item) => total + item.harga, 0);
  let totalHarga = subtotal + ongkir;

  document.getElementById('subtotal-modal').textContent = `Rp ${subtotal.toLocaleString()}`;
  document.getElementById('ongkir-modal').textContent = `Rp ${ongkir.toLocaleString()}`;
  document.getElementById('wilayah-modal').textContent = wilayah || 'Jakarta';
  document.getElementById('total-modal').textContent = `Rp ${totalHarga.toLocaleString()}`;
  document.getElementById('modal-qris').style.display = 'flex';
}

function resetStatusPesanan() {
  const statusItems = document.querySelectorAll('.status-item');
  statusItems.forEach(item => {
    item.classList.remove('active', 'completed');
  });
  document.getElementById('progress-fill').style.width = '0%';
}

function konfirmasiBayar() {
  document.getElementById('modal-qris').style.display = 'none';
  document.getElementById('katalog').style.display = 'none';
  document.getElementById('keranjang').style.display = 'none';
  keranjang = [];
  updateKeranjang();
  document.getElementById('status-pesanan').style.display = 'block';
  resetStatusPesanan();

  const statusPesan = document.getElementById('status-pesan');
  statusPesan.classList.add('completed');

  const statusMasak = document.getElementById('status-masak');
  statusMasak.classList.add('active');

  document.getElementById('progress-fill').style.width = '40%';
  alert('Pembayaran berhasil! Pesanan Anda sedang disiapkan.');
  document.getElementById('waktu-estimasi').textContent = '30-45 menit';
}

function tutupModal() {
  document.getElementById('modal-qris').style.display = 'none';
}

document.addEventListener('DOMContentLoaded', () => {
    const namaUser = localStorage.getItem('namaUser');
    if (namaUser) {
        document.getElementById('user-nama').textContent = `ü´Ö ${namaUser}`;
    }

    const alamat = localStorage.getItem('alamatPengiriman');
    const wilayah = localStorage.getItem('wilayahJakarta');
    if (alamat && wilayah) {
        document.getElementById('alamat-info').textContent = `üìç ${alamat}, ${wilayah}`;
    }

    showCategory('makanan');
});